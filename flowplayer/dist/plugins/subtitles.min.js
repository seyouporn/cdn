!function(t,n){"object"==typeof exports&&"undefined"!=typeof module?module.exports=n():"function"==typeof define&&define.amd?define(n):((t=t||self).flowplayer=t.flowplayer||{},t.flowplayer.subtitles=n())}(this,(function(){"use strict";var t=[].slice;function n(t,n){for(var e in n)t[e]=n[e];return t}function e(t,n,e){for(n=function(t){return Array.isArray(t)?t.slice(0):t.split(".")}(n);n.length;){if(null==t)return e;t=t[n.shift()]}return null==t?e:t}function r(n){return t.call(n)}function i(t){return t.emit=function(e,r,i){i=i||{};var o=function(t){var n=document.createEvent("Event");return n.initEvent(t,!1,!0),n}(e);return r&&n(o,{data:r||{}}),t.dispatchEvent(o),!1===i.return_self?o:t},t.on=function(n,e){return"string"==typeof n&&(n=n.split(" ")),n.forEach((function(n){t.addEventListener(n,e)})),t},t.off=function(n,e){return t.removeEventListener(n,e),t},t.one=t.once=function(n,e){return t.on(n,(function r(i){t.off(n,r),e(i)}))},t}var o="",a=" ",c=Array.isArray,s="undefined"!=typeof window&&i(window),u="undefined"!=typeof document&&i(document),f=["span","a","em","p","i"],l=f.concat(["div","strong","video","img","ol","ul","li","script"]),d="__flowplayer__";function p(t,n,e){var r=m(document.createElement(t));if(c(n)&&(e=n,n=!1),c(e)||(e=[e]),r.append(e.filter((function(t){return t}))),"object"!=typeof n)return r;for(var i in n)i in r?r[i]=n[i]:r.setAttribute(i,n[i]);return r}function m(t){return void 0===t?t:function(t){return t&&t[d]}(t)?t:function(t){var n=t.tagName;t[d]=1,t.find=function(n){var e=t.querySelector(n);return e?m(e):e},t.html=function(n){return t.innerHTML=n,t},t.empty=function(){return t.innerHTML=o,t},t.offset=function(){var n={top:0,left:0},e=t;do{n.left+=e.offsetLeft||0,n.top+=e.offsetTop||0}while(e=e.offsetParent);return n},t.innerWidth=function(){var n=getComputedStyle(t);return t.clientWidth-parseFloat(n.paddingLeft)-parseFloat(n.paddingRight)};var e=t.insert=function(n,e){return c(e)?e.map((function(e){return t.insert(n,e)}))[0]:m(e="string"==typeof e?t.insertAdjacentHTML(n,e):t.insertAdjacentElement?t.insertAdjacentElement(n,e):t.appendChild(e))};return t.append=e.bind(t,"beforeend"),t.prepend=e.bind(t,"afterbegin"),t.css=function(n,e){if("object"==typeof n){for(var r in n)t.css(r,n[r]);return t}return void 0===e?getComputedStyle(t)[n]:(1*e&&(e+="px"),t.style[n]=e,t)},t.show=function(){return t.css({display:~f.indexOf(n)?"inline":"block"})},t.hide=function(){return t.css({display:"none"})},t.remove=function(){var n=t.parentNode;n&&n.removeChild(t)},t.attr=function(n,e){return null==e?t.getAttribute(n):(t.setAttribute(n,e),t)},t.txt=function(n){return t.textContent=n,t},t.fp=function(n){return t.addClass("fp-"+n)},t.addClass=function(n){return n.split(a).forEach((function(n){t.hasClass(n)||(t.className+=(t.className?a:o)+n)})),t},t.removeClass=function(n){n=n.split(a);var e=t.className.split(a);return t.className=e.filter((function(t){return!~n.indexOf(t)})).join(" "),t},t.toggleClass=function(n,e){return void 0===e&&(e=!t.hasClass(n)),e?t.addClass(n):t.removeClass(n)},t.findAll=function(n){return r(t.querySelectorAll(n))},t.hasClass=function(n){return~t.className.split(a).indexOf(n)},t}(i(t))}function v(t,n){if("string"==typeof t&&"<"==t[0])return p(t.slice(1,-1),n);if("string"!=typeof t)return m(t);var e=n instanceof HTMLElement&&n.querySelector(".fp-"+t)||document.querySelector(t);return e?m(e):void 0}v.window=s,v.document=u,v.el=p,l.forEach((function(t){v[t]=function(n,e){return"string"==typeof n&&(n={class:n}),p(t,n,e)}}));var h="mount",g="click",y="mouseleave",x="state",_="config",b="tracks:text:updated";function k(t){return document.createElementNS("http://www.w3.org/2000/svg",t)}function E(t){var n,e,r=k("svg");return r.setAttribute("viewBox",t.coords),t.name&&r.setAttribute("class",t.name),t.title&&r.setAttribute("title",t.title),t.title&&r.setAttribute("aria-label",t.title),r.setAttribute("tabindex","0"),r.appendChild((n=t.link,(e=k("use")).setAttributeNS("http://www.w3.org/1999/xlink","xlink:href",n),e)),v(r)}var w={TOGGLE_OPEN:"menu:toggle:open",RENDER:"menu:render",PUSH:"menu:push"},C={ON:"fp-on",INVIS:"fp-invis"};function O(e,r,i){var o=i.id||"menu-"+Math.random().toString(36).replace(/[^a-z]+/g,"").substr(0,5);return i=i||{},e.attr("role","button").attr("aria-haspopup","true").attr("aria-expanded","false").attr("aria-controls",o).attr("aria-label",i.title),i.options=i.options||[],i.id=o,O._interface(e,r,function(){var e=t.call(arguments),r=e.shift();return e.reduce(n,r)}({},i))}function N(t){return"function"==typeof t}function A(){throw new Error("Function was expected as Argument[0]")}O.title=function(t){return v("<h3>").txt(t)},O.close=function(t){return v.span("fp-close").on(g,t).html("&times;")},O.option=function(t,n){var e=this,r=v("<li>").attr("tabindex","0").attr("role","menuitem"),i=e._attrs;t.icon&&r.append(E(t.icon)),r.append(v("<span>").txt(t.text)),r.on(g,(function(r){i.multi||e.options().forEach(O.off),e.activate(n),"function"==typeof t.onclick&&t.onclick(r,t,n,e)})),r.idx=n,e.append(r)},O._interface=function(t,n,r){t.addClass("fp-menu-container");var i=v("<ul>").attr("id",r.id).addClass("fp-menu").attr("role","menu");return r.icons&&i.addClass("fp-icons"),i._attrs=r,t.on(g,(function(t){setTimeout((function(){if(!t.defaultPrevented)return i.hasClass(C.ON)?n.emit(w.TOGGLE_OPEN,{menu:i,open:!1}):void n.emit(w.TOGGLE_OPEN,{menu:i,open:!0})}),0)})),i.on(y,(function(){n.emit(w.TOGGLE_OPEN,{menu:i,open:!1})})),n.on(w.TOGGLE_OPEN,(function(r){if(e(r,"data.menu")!==i)return i.toggleClass(C.ON,!1),t.attr("aria-expanded","false");var o=e(r,"data.open",!1);if(i.toggleClass(C.ON,o),t.attr("aria-expanded",o?"true":"false"),n.hasClass("is-accessibility"))if(o){var a=i.options()[0];a&&a.focus()}else t.focus()})),i.push=function(t){return i._attrs.options=e(i,"_attrs.options",[]),i._attrs.options.push(t),i.render()},i.select=function(t){return i.render(i.options.filter(t))},i.render=function(n){var e=i._attrs;return i.empty(),i.prepend(O.close()),e.title&&i.prepend(O.title(e.title)),e.options=n||e.options,e.options.forEach(O.option,i),t.toggleClass(C.INVIS,0==e.options.length),i._activate(),i},i.close=function(){i.hasClass(C.ON)&&n.emit(w.TOGGLE_OPEN,{menu:i,open:!1})},i._activate=function(){i.options().forEach((function(t){t.toggleClass(C.ON,t.idx===i.idx)}))},i.options=function(){return[].slice.call(i.querySelectorAll("li"))},i.activate=function(t,n){void 0===i.idx||i.idx!==t||n?i.idx=t:delete i.idx,i._activate()},i.deactivate=function(){i.activate(i.idx)},i.render(r.options),t.appendChild(i),i},O.on=function(t){return t.addClass(C.ON),t},O.off=function(t){return t.removeClass(C.ON),t},O.CONTAINER_CLASS="fp-menu",O.Events=w,O.States=C;var S=[].slice;function T(t){if(!(this instanceof T))return new T(t);var n=this;return n.data=t,n.tap=function(){var t=S.call(arguments),e=t.shift();return e==T.lift?n.data:N(e)?(e.apply(n,[n.data].concat(t)),n):void A()},n.into=n.fmap=function(){var t=S.call(arguments),e=t.shift();return e==T.lift?n.data:N(e)?T(e.apply(n,[n.data].concat(t))):void A()},n.unwrap=function(){return n.data},n}T.of=T,T.lift=function(t){return t instanceof T?t.data:t},T._apply=function(t,n){if(0==n.length)return t();if(1==n.length)return t(n[0]);if(2==n.length)return t(n[0],n[1]);if(3==n.length)return t(n[0],n[1],n[2]);if(4==n.length)return t(n[0],n[1],n[2],n[3]);if(5==n.length)return t(n[0],n[1],n[2],n[3],n[4]);throw new Error("Pipe._apply() does not support arity > 5")},T.maybe=function(t,n,e){return t?T._apply(n,[t].concat(S.call(arguments,2,arguments.length))):t},T.curry=function(t,n,e){return(n=n||[]).length>t.length-1?t.apply(e,n):function(){return n=n.concat(S.call(arguments)),T.curry(t,n,e)}};var L="anonymous",G="use-credentials";function j(t,n){if(function(t){switch(t){case"":case L:case G:return!0;default:console.warn("Invalid(crossorigin: %s) must be one of '', 'anonymous', or 'use-credentials'\nhttps://developer.mozilla.org/en-US/docs/Web/HTML/CORS_settings_attributes",t)}}(n=n||L),t.crossOrigin!=n)return t.attr("crossorigin",n),t}function P(t){var n=document.createElement("a");return n.href=t,n.origin}function q(t,n){var e=function(t,n){return t.querySelector("track[src='"+n+"']")}(n,t.src);if(e)return e;"string"!=typeof t.crossorigin&&function(t,n){try{return t.src.indexOf("blob:"),P(t.src)!==P(n)}catch(t){return console.error(t),!0}}(n,t.src)&&(j(n),t.crossorigin=n.attr("crossorigin")),"crossorigin"in t&&j(n,t.crossorigin),"object"==typeof t&&1==t.is_default&&(delete t.is_default,t.default=!0),t.default||delete t.default,t.id=t.id||[t.srclang,t.label,t.lang].filter((function(t){return!!t})).join("-");var r=v("<track>",t);return n.append(r),r}function H(t,n){return{text:t.label,track:t,onclick:I.bind(0,n)}}function I(t,n,e,r,i){[].forEach.call(t.textTracks,(function(n){return"showing"==n.mode&&e.track==n?(i.deactivate(r,!1),t.emit(b),n.mode="disabled"):n==e.track?(i.activate(r,!0),t.emit(b,n),n.mode="showing"):void(n.mode="disabled")}))}var M=["subtitles","captions","descriptions"];function R(t){return t.filter((function(t){return t&&~M.indexOf(t.kind)}))}function F(t){var n=document.createElement("a");return n.href=t,n}var W="is-playing";function z(t,n){return 1==t.filter((function(t){return e=t.src,r=n,F(e).href==F(r).href;var e,r})).length}function D(t,n,e){T.of(t).fmap(U,H,e).fmap(n.render),t.forEach((function(t,e){"showing"==t.mode&&n.activate(e)}))}function U(t,n,e,r,i){return t.map((function(t){return n.call(this,t,e,r,i)}))}return function(t,n){if("object"==typeof exports&&"undefined"!=typeof module)return n;"flowplayer"in t||(t.flowplayer={extensions:[]});var e=t.flowplayer;return"function"==typeof e?(e(n),n):(Array.isArray(e.extensions)||(e.extensions=[]),~e.extensions.indexOf(n)||e.extensions.push(n),n)}(window,(function(t,n,i){var o=v.span("fp-cc fp-menu-container").attr("tabindex","0"),a=O(o,n,{title:i._t("cc.menu_title"),options:[]});i.reaper.put("_tracks",[]),i.reaper.put("_track_elements",[]),o.on("click",(function(t){var n=T.of(i._tracks).fmap(r).fmap(R).fmap(T.lift);1===n.length&&(t.preventDefault(),a.options().shift().emit("click"),function(t,n){n.toggleClass("fp-color-text","showing"==t.mode)}(n[0],o))})),i.on(_,(function(){T.of(t).fmap(e,"subtitles.tracks").tap(T.maybe,(function(t){var n=i._track_elements||[];n.slice(0).forEach((function(e,r){z(t,e.src)||(e.remove(),n.splice(r,1))}))})).tap(T.maybe,(function(t){return i._track_elements=U(t,q,i),i._track_elements.map((function(t){return t.track}))})).tap(T.maybe,(function(){i._tracks=r(i.textTracks)})).tap(T.maybe,(function(t){i.emit("tracks:text:all",i._tracks),i._tracks.forEach((function(t,n){"showing"==t.mode&&a.activate(n,!0)}))}))})),i.one(h,(function(){if(0!=n.reaper&&(n.controls&&n.controls.append(o),0!=i.textTracks.length)){var t=r(i.textTracks);i.emit("tracks:text:all",t)}})),i.textTracks.addEventListener("addtrack",(function(){i.hls||i.emit("tracks:text:all",r(i.textTracks))})),i.textTracks.addEventListener("removetrack",(function(){i.hls||i.emit("tracks:text:all",r(i.textTracks))})),i.on("tracks:text:all",(function(t){i._tracks=e(t,"data",[]),function(t,n,e,i){var o=T.of(t).fmap(r).fmap(R).tap(D,e,n).fmap(T.lift);1==o.length&&i.toggleClass("fp-color-text","showing"==o[0].mode)}(i._tracks,i,a,o)})),i.on("tracks:text:change",(function(t){"number"==typeof t.data&&a.activate(t.data)})),i.on(x,(function(t){i.hasState("is-touched")||i.hasState("is-hovered")||!i.hasState(W)||a.close()}))}))}));
