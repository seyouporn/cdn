!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):((e=e||self).flowplayer=e.flowplayer||{},e.flowplayer.chromecast=t())}(this,(function(){"use strict";var e=[].slice;function t(e,t,n){for(t=function(e){return Array.isArray(e)?e.slice(0):e.split(".")}(t);t.length;){if(null==e)return n;e=e[t.shift()]}return null==e?n:e}function n(e){switch(e){case"video/mpd":return"application/dash+xml";case"video/m3u8":return"application/x-mpegurl";default:return e}}function r(e){var t=e.split("{"),r=t[1];return r?r.slice(0,-1).split(",").map((function(e){return{src:t[0]+e,type:n("video/"+e)}})):[{src:e,type:n("video/"+function(e){var t=document.createElement("a");t.href=e;var n=t.pathname&&t.pathname.split(".");return n.length>1&&n[n.length-1]}(e))}]}function a(e){return"function"==typeof e}function o(){throw new Error("Function was expected as Argument[0]")}var i=[].slice;function c(e){if(!(this instanceof c))return new c(e);var t=this;return t.data=e,t.tap=function(){var e=i.call(arguments),n=e.shift();return n==c.lift?t.data:a(n)?(n.apply(t,[t.data].concat(e)),t):void o()},t.into=t.fmap=function(){var e=i.call(arguments),n=e.shift();return n==c.lift?t.data:a(n)?c(n.apply(t,[t.data].concat(e))):void o()},t.unwrap=function(){return t.data},t}c.of=c,c.lift=function(e){return e instanceof c?e.data:e},c._apply=function(e,t){if(0==t.length)return e();if(1==t.length)return e(t[0]);if(2==t.length)return e(t[0],t[1]);if(3==t.length)return e(t[0],t[1],t[2]);if(4==t.length)return e(t[0],t[1],t[2],t[3]);if(5==t.length)return e(t[0],t[1],t[2],t[3],t[4]);throw new Error("Pipe._apply() does not support arity > 5")},c.maybe=function(e,t,n){return e?c._apply(t,[e].concat(i.call(arguments,2,arguments.length))):e},c.curry=function(e,t,n){return(t=t||[]).length>e.length-1?e.apply(n,t):function(){return t=t.concat(i.call(arguments)),c.curry(e,t,n)}};var u="chromecast:available",s="chromecast:unavailable",f="chromecast:start",l="chromecast:idle",p="chromecast:state:changed",d="chromecast:session:changed",m="chromecast:field:update";function y(){return h().fmap(c.maybe,(function(e){return e.getCurrentSession()}))}function v(){return y().fmap(c.maybe,(function(e){return e.getMediaSession()}))}function h(){return c.of(window).fmap(t,"cast.framework.CastContext").fmap(c.maybe,(function(e){return e.getInstance()}))}function g(){return t(window,"flowplayer.instances",[])}function w(){return g().filter((function(e){return B.is_same(e)}))}function E(){return g().filter((function(e){return!B.is_same(e)}))}function S(e,t){w().forEach((function(n){n.emit(e,t)}))}function T(e,t){E().forEach((function(n){n.emit(e,t)}))}function _(e,t){g().forEach((function(n){n.emit(e,t)}))}var b={PAUSED:"isPaused",CURRENT_TIME:"currentTime",DURATION:"duration",CONNECTED:"isConnected",PLAYER_STATE:"playerState",SAVED_STATE:"savedPlayerState",DISPLAY_NAME:"displayName",STATUS:"statusText"},C={player:void 0,controller:void 0};function A(){C.player=new cast.framework.RemotePlayer,C.controller=new cast.framework.RemotePlayerController(C.player),C.controller.addEventListener(cast.framework.RemotePlayerEventType.ANY_CHANGE,k),C.controller.addEventListener(cast.framework.RemotePlayerEventType.MEDIA_INFO_CHANGED,(function(){T(l)}))}function k(e){S(m,e)}function N(e){var n=[].slice.call(e.querySelectorAll("track")),r=t(e,"hls.subtitleTracks",[]);return[].concat.apply([],n,r).filter((function(e){return"string"==typeof e.lang}))}function x(e){return N(e).map((function(e,t){var n=new chrome.cast.media.Track(t,chrome.cast.media.TrackType.TEXT);return n.trackContentType="text/vtt",n.subtype=chrome.cast.media.TextTrackType.SUBTITLES,n.trackContentId=e.src||e.url,n.name=e.label||e.name,n.language=e.lang,n}))}function I(e){M().fmap(c.maybe,(function(t){var n=new chrome.cast.media.EditTracksInfoRequest(e);t.editTracksInfo(n,console.debug,console.error)}))}var L=Object.freeze({__proto__:null,getCurrentSession:y,getMediaSession:v,getCastContext:h,players:g,casting_players:w,idle_players:E,broadcast_to_active:S,broadcast_to_idle:T,broadcast:_,FIELDS:b,SINGLETONS:C,refresh_singletons:A,onremotechange:k,tracks:N,cast_tracks:x,editTracks:I});function O(e,n,r){y().fmap(c.maybe,(function(n){var a=B.get_media(e);if(a){var o=new chrome.cast.media.MediaInfo(a.src,a.type);o.tracks=x(e),o.metadata=new chrome.cast.media.GenericMediaMetadata;var i=new chrome.cast.media.LoadRequest(o);isNaN(e.currentTime)||(i.currentTime=e.currentTime),o.tracks.length&&(i.activeTrackIds=N(e).filter((function(e){return"showing"==t(e,"track.mode",e.mode)})).map((function(e,t){return t}))),console.debug("cast:request(%o)",i),n.loadMedia(i).then((function(){HTMLMediaElement.prototype.pause.call(e),A(),T(l)}),r)}}))}function M(){return v()}function P(){return!!v().unwrap()}function D(){return!!y().unwrap()}function j(){return y().fmap(c.maybe,(function(e){return e.getCastDevice().friendlyName})).unwrap()}function R(){return M().fmap(c.maybe,t,"media.duration").unwrap()}function q(){return M().fmap(c.maybe,t,"playerState").unwrap()}function H(e){return e?U(e):M().fmap(c.maybe,(function(e){return e.getEstimatedTime()})).unwrap()}function U(e){return M().fmap(c.maybe,(function(t){var n=new chrome.cast.media.SeekRequest;return n.currentTime=e,t.seek(n)})),e}function G(){return M().fmap(c.maybe,(function(e){return e.play()})).unwrap()}function F(){return M().fmap(c.maybe,(function(e){return e.pause()})).unwrap()}var Y=Object.freeze({__proto__:null,load:O,media:M,has_media:P,exists:D,device_name:j,duration:R,state:q,currentTime:H,seek:U,play:G,pause:F});var z=/(video\/mp4)|(application\/x-mpegurl)|(video\/mpd)|(application\/dash\+xml)/;function B(e){this.video=e,function(e,t){var n={play:function(){return B.is_same(t)?G():P()?B.load(t):void B.load(t)},pause:function(){return B.is_same(t)?F():HTMLMediaElement.prototype.pause.call(t)}};n.currentTime={get:H,set:H},n.duration={get:R},n.paused={get:function(){return"PAUSED"===q()}},n.playing={get:function(){return"PLAYING"===q()}},Object.keys(n).forEach((function(e){if("object"==typeof n[e])return Object.defineProperty(t,e,{get:function(){return B.is_same(t)?n[e].get():Object.getOwnPropertyDescriptor(HTMLMediaElement.prototype,e).get.call(this)},set:function(r){return B.is_same(t)?n[e].set(r):Object.getOwnPropertyDescriptor(HTMLMediaElement.prototype,e).set.call(this,r)}});var r=t[e];t[e]=function(){var t=[].slice.apply(arguments);return D()?n[e].apply(this,t):r.apply(this,t)}}))}(0,e)}function J(){}B.of=function(e){return e.sender?e.sender:(e.sender=new B(e),e.sender)},B.normalize_src=function(e){return c.of(e).fmap(t,"opts.src",[]).fmap((function(e){return"string"==typeof e?r(e):e})).fmap((function(e){return e.map((function(e){return"string"==typeof e?r(e):e}))})).fmap((function(e){return[].concat.apply([],e)})).fmap((function(e){return e.filter(B.is_supported_media)}))},B.is_same=function(e){const n=B.normalize_src(e).unwrap().map((function(e){return t(e,"src")}));return M().fmap(c.maybe,t,"media.contentId").fmap(c.maybe,(function(e){return!!~n.indexOf(e)})).unwrap()},B.maybe=function(e,t){e.sender&&t(e.sender,e)},B.getEstimatedTime=function(){return v().fmap(c.maybe,(function(e){return e.getEstimatedTime()})).unwrap()},B.is_supported_media=function(e){return t(e,"type","").toString().match(z)},B.load=function(e){O(e,console.debug,console.error)},B.destroy=function(e){e.video=0},B.get_media=function(e){return B.normalize_src(e).fmap(c.maybe,(function(e){return e.pop()})).unwrap()};var W="https://www.gstatic.com/cv/js/sender/v1/cast_sender.js?loadCastFramework=1",V="6F71FA7C",X="__onGCastApiAvailable";function K(){if(document.querySelector("script[src='"+W+"']"))return Z();var e,t,n,r;e=W,n=document.getElementsByTagName("head")[0],(r=document.createElement("script")).src=e,r.onload=r.onerror=t||J,n.appendChild(r),window[X]=function(){!function(){if(!Q())return;h().fmap(c.maybe,(function(e){e.setOptions({receiverApplicationId:V,autoJoinPolicy:chrome.cast.AutoJoinPolicy.ORIGIN_SCOPED}),e.addEventListener(cast.framework.CastContextEventType.CAST_STATE_CHANGED,(function(e){_(p,e)})),e.addEventListener(cast.framework.CastContextEventType.SESSION_STATE_CHANGED,(function(e){A(),_(d,e)}))}))}(),Z()}}function Q(){return"object"==typeof window.cast}function Z(){if(Q())return _(u);_(s)}var $="is-chromecast-playing";function ee(e){return e.emit=function(t,n,r){r=r||{};var a=function(e){var t=document.createEvent("Event");return t.initEvent(e,!1,!0),t}(t);return n&&function(e,t){for(var n in t)e[n]=t[n]}(a,{data:n||{}}),e.dispatchEvent(a),!1===r.return_self?a:e},e.on=function(t,n){return"string"==typeof t&&(t=t.split(" ")),t.forEach((function(t){e.addEventListener(t,n)})),e},e.off=function(t,n){return e.removeEventListener(t,n),e},e.one=e.once=function(t,n){return e.on(t,(function r(a){e.off(t,r),n(a)}))},e}var te="",ne=" ",re=Array.isArray,ae="undefined"!=typeof window&&ee(window),oe="undefined"!=typeof document&&ee(document),ie=["span","a","em","p","i"],ce=ie.concat(["div","strong","video","img","ol","ul","li","script"]),ue="__flowplayer__";function se(e,t,n){var r=le(document.createElement(e));if(re(t)&&(n=t,t=!1),re(n)||(n=[n]),r.append(n.filter((function(e){return e}))),"object"!=typeof t)return r;for(var a in t)a in r?r[a]=t[a]:r.setAttribute(a,t[a]);return r}function fe(t){var n=t.tagName;t[ue]=1,t.find=function(e){var n=t.querySelector(e);return n?le(n):n},t.html=function(e){return t.innerHTML=e,t},t.empty=function(){return t.innerHTML=te,t},t.offset=function(){var e={top:0,left:0},n=t;do{e.left+=n.offsetLeft||0,e.top+=n.offsetTop||0}while(n=n.offsetParent);return e},t.innerWidth=function(){var e=getComputedStyle(t);return t.clientWidth-parseFloat(e.paddingLeft)-parseFloat(e.paddingRight)};var r=t.insert=function(e,n){return re(n)?n.map((function(n){return t.insert(e,n)}))[0]:le(n="string"==typeof n?t.insertAdjacentHTML(e,n):t.insertAdjacentElement?t.insertAdjacentElement(e,n):t.appendChild(n))};return t.append=r.bind(t,"beforeend"),t.prepend=r.bind(t,"afterbegin"),t.css=function(e,n){if("object"==typeof e){for(var r in e)t.css(r,e[r]);return t}return void 0===n?getComputedStyle(t)[e]:(1*n&&(n+="px"),t.style[e]=n,t)},t.show=function(){return t.css({display:~ie.indexOf(n)?"inline":"block"})},t.hide=function(){return t.css({display:"none"})},t.remove=function(){var e=t.parentNode;e&&e.removeChild(t)},t.attr=function(e,n){return null==n?t.getAttribute(e):(t.setAttribute(e,n),t)},t.txt=function(e){return t.textContent=e,t},t.fp=function(e){return t.addClass("fp-"+e)},t.addClass=function(e){return e.split(ne).forEach((function(e){t.hasClass(e)||(t.className+=(t.className?ne:te)+e)})),t},t.removeClass=function(e){e=e.split(ne);var n=t.className.split(ne);return t.className=n.filter((function(t){return!~e.indexOf(t)})).join(" "),t},t.toggleClass=function(e,n){return void 0===n&&(n=!t.hasClass(e)),n?t.addClass(e):t.removeClass(e)},t.findAll=function(n){return r=t.querySelectorAll(n),e.call(r);var r},t.hasClass=function(e){return~t.className.split(ne).indexOf(e)},t}function le(e){return void 0===e?e:function(e){return e&&e[ue]}(e)?e:fe(ee(e))}function pe(e,t){if("string"==typeof e&&"<"==e[0])return se(e.slice(1,-1),t);if("string"!=typeof e)return le(e);var n=t instanceof HTMLElement&&t.querySelector(".fp-"+e)||document.querySelector(e);return n?le(n):void 0}pe.window=ae,pe.document=oe,pe.el=se,ce.forEach((function(e){pe[e]=function(t,n){return"string"==typeof t&&(t={class:t}),se(e,t,n)}}));var de="mount",me="timeupdate",ye="pause",ve="playing",he="reap";var ge="is-starting";return window.CastSession=Y,window.CastUtils=L,function(e,t){if("object"==typeof exports&&"undefined"!=typeof module)return t;"flowplayer"in e||(e.flowplayer={extensions:[]});var n=e.flowplayer;return"function"==typeof n?(n(t),t):(Array.isArray(n.extensions)||(n.extensions=[]),~n.extensions.indexOf(t)||n.extensions.push(t),t)}(window,(function(e,n,r){"https:"!==location.protocol&&"localhost"!==location.hostname&&"127.0.0.1"!==location.hostname&&console.warn("Secure URL required to enable Chromecast"),K();var a={pending:void 0};r.on(he,(function(){B.maybe(r,B.destroy)})),r.on(de,(function(){var a,o,i,c,u=t(n,"middle");u&&(a=u,o={poster:e.poster},i=pe.div("fp-chromecast"),c=pe.el("p"),o.poster&&(i.style.backgroundImage=["url(",o.poster,")"].join("")),i.append(c),a.prepend(i));var s=t(n,"ui.header.secondary");s&&function(e,t){var n=pe.el("span").addClass("fp-cast-button");n.append(pe.el("google-cast-launcher")),e.prepend(n),n.on("click",(function(){const e=y().unwrap();if(e)return e.endSession(!0);t.emit(f)}))}(s,r)})),r.on(u,(function(){r.setState("is-cast-available",!0),B.of(r)})),r.on(s,(function(){r.setState("is-cast-available",!1),B.maybe(r,B.destroy)})),r.on(f,(function(){if(P())return B.load(r);a.pending=!0})),r.on("tracks:text:updated",(function(e){if(P())return e.data?void I(N(r).map((function(e,t){return{track:e.track,id:t}})).filter((function(t){return t.track==e.data})).map((function(e){return e.id}))):I([])})),r.on(l,(function(){r.setState($,!1),r.setState(ge,!0)})),r.on(m,(function(e){var n=t(e,"data.field"),a=t(e,"data.value");switch(n){case b.CURRENT_TIME:return r.emit(me,a);case b.PLAYER_STATE:return"PLAYING"==a?r.emit(ve):"PAUSED"==a?r.emit(ye):void 0;case"mediaInfo":return function(e,n){if(0!=e.root){var r=e.root.querySelector(".fp-chromecast p");if(r){var a="";a=(a=e._t("chromecast.message","{{state}} on {{device}}").replace("{{device}}",t(n,"device","chromecast"))).replace("{{state}}",t(n,"state","").toLowerCase()),r.txt(a)}}}(r,{device:j(),state:q()}),r.setState(ge,!1),r.setState($,!0)}})),r.on(d,(function(e){switch(t(e,"data.sessionState")){case cast.framework.SessionState.SESSION_ENDED:return r.setState($,!1);case cast.framework.SessionState.SESSION_RESUMED:case cast.framework.SessionState.SESSION_STARTED:a.pending&&(a.pending=!1,B.load(r))}}))}))}));
