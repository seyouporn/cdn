!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):((e=e||self).flowplayer=e.flowplayer||{},e.flowplayer.drm=t())}(this,(function(){"use strict";var e={MOUNT:"mount",ERROR:"error",CONTEXT_MENU:"contextmenu",CLICK:"click",DBL_CLICK:"dblclick",KEYUP:"keyup",KEYDOWN:"keydown",LOAD:"load",MOUSE_ENTER:"mouseenter",MOUSE_LEAVE:"mouseleave",MOUSE_UP:"mouseup",MOUSE_DOWN:"mousedown",MOUSE_MOVE:"mousemove",TOUCH_START:"touchstart",TOUCH_MOVE:"touchmove",TOUCH_END:"touchend",TOUCH_CANCEL:"touchcancel",RESIZE:"resize",SCROLL:"scroll",FULLSCREEN_ENTER:"fullscreenenter",FULLSCREEN_EXIT:"fullscreenexit",FULLSCREEN_CHANGE:"fullscreenchange",WEBKIT_NEEDKEY:"webkitneedkey",METADATA:"loadedmetadata",DATA:"loadeddata",PROGRESS:"progress",TIME_UPDATE:"timeupdate",LOAD_START:"loadstart",VOLUME_CHANGE:"volumechange",PAUSE:"pause",PLAYING:"playing",PLAY:"play",WAITING:"waiting",CAN_PLAY:"canplay",ENDED:"ended",SEEKED:"seeked",SEEKING:"seeking",DURATION_CHANGE:"durationchange",BEFORE_PLAY:"beforeplay",BEFORE_PAUSE:"beforepause",STATE:"state",CUEPOINTS:"cuepoints",CUEPOINT_START:"cuepointstart",CUEPOINT_END:"cuepointend",VIEW_ENTER:"viewenter",VIEW_LEAVE:"viewleave",SOURCE:"src",RECOVER:"recover",REAP:"reap",CONFIG:"config",QUALITIES:"qualities",SET_QUALITY:"quality:set",NON_RECOVERABLE_ERROR:"error:fatal",RECOMMENDATIONS_READY:"recommendationsready",AUDIO_ONLY_SOURCE:"audioonlysource"},t=[].slice;function n(e,t){for(var n in t)e[n]=t[n];return e}function r(){var e=t.call(arguments),r=e.shift();return e.reduce(n,r)}function a(e,t,n){for(t=function(e){return Array.isArray(e)?e.slice(0):e.split(".")}(t);t.length;){if(null==e)return n;e=e[t.shift()]}return null==e?n:e}var o="com.widevine.alpha",i="com.microsoft.playready",s="org.w3.clearkey",E="com.apple.fps.1_0",u="license_server",c="http_headers",f="certificate";function d(e){var t={};return Object.keys(e).forEach((function(n){var r;r=n,[o].filter((function(e){return e===r})).length&&function(e,t,n){if(e===o){n.widevineLicenseUrl=t[e][u],n.emeEnabled=!0;var r=t[e][c];r&&(n.licenseXhrSetup=function(e){Object.keys(r).forEach((function(t){e.setRequestHeader(t,r[t])}))})}}(n,e,t)})),t}function l(e){var t={};return Object.keys(e).forEach((function(n){var r;r=n,[o,i,s].filter((function(e){return e===r})).length&&(t[n]=function(e,t){var n={serverURL:t[e][u]};return t[e][c]&&(n.httpRequestHeaders=t[e][c]),n}(n,e))})),t}function p(e,t,n){var r,a,o;t[E]&&(e.src&&e.src.indexOf(!1)||(r=t[E][f],a=function(r){e.webkitSetMediaKeys(new WebKitMediaKeys("com.apple.fps.1_0"));var a=n.initData,o=function(e){var t,n=(t=new Uint16Array(e.buffer),String.fromCharCode.apply(null,t));return n.substring(n.indexOf("skd:")).split(";")[1]}(a);a=function(e,t,n){"string"==typeof t&&(t=function(e){for(var t=new ArrayBuffer(2*e.length),n=new Uint16Array(t),r=0,a=e.length;r<a;r++)n[r]=e.charCodeAt(r);return n}(t));var r=0,a=new ArrayBuffer(e.byteLength+4+t.byteLength+4+n.byteLength),o=new DataView(a);new Uint8Array(a,r,e.byteLength).set(e),r+=e.byteLength,o.setUint32(r,t.byteLength,!0),r+=4;var i=new Uint16Array(a,r,t.length);return i.set(t),r+=i.byteLength,o.setUint32(r,n.byteLength,!0),r+=4,new Uint8Array(a,r,n.byteLength).set(n),new Uint8Array(a,0,a.byteLength)}(a,o,r);var i=e.webkitKeys.createSession("application/x-mpegurl",a);i.addEventListener("webkitkeyerror",console.debug.bind(console,"webkitkeyerror")),i.addEventListener("webkitkeymessage",(function(e){var n,r,a,s;n=t[E][u],r={message:e.message,assetId:o},a=function(e){i.update(e)},(s=new XMLHttpRequest).responseType="arraybuffer",s.addEventListener("load",(function(){s.status>=400||a(new Uint8Array(s.response))}),!1),s.open("POST",n+r.assetId,!0),s.setRequestHeader("Content-type","application/octet-stream"),s.send(r.message)}))},(o=new XMLHttpRequest).responseType="arraybuffer",o.addEventListener("load",(function(){a(new Uint8Array(o.response))}),!1),o.open("GET",r,!0),o.send()))}function y(t,n,o){o.on(e.CONFIG,(function(e){t=e.data})),o.on(e.SOURCE,(function(n){if(n.data.drm){var i=a(t,"hls",{}),s=n.data.drm?d(n.data.drm):{};o.setOpts({hls:r(i,s)}),o.on(e.WEBKIT_NEEDKEY,p.bind(null,o,n.data.drm||{}));var E=a(t,"dash",{}),u=n.data.drm?l(n.data.drm):{};o.setOpts({dash:r(E,{drm:u})})}}))}return r(y,Object.freeze({__proto__:null,WIDEVINE:o,PLAYREADY:i,CLEARKEY:s,FAIRPLAY:E,LICENSE_SERVER:u,KEY:"key",KEY_ID:"kid",HTTP_HEADERS:c,CERTIFICATE:f})),function(e,t){if("object"==typeof exports&&"undefined"!=typeof module)return t;"flowplayer"in e||(e.flowplayer={extensions:[]});var n=e.flowplayer;"function"==typeof n?n(t):(Array.isArray(n.extensions)||(n.extensions=[]),~n.extensions.indexOf(t)||n.extensions.push(t))}(window,y),y}));
