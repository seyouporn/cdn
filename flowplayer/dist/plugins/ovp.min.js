!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):((e=e||self).flowplayer=e.flowplayer||{},e.flowplayer.ovp=t())}(this,(function(){"use strict";var e="undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{};var t=[].slice;function n(){}function r(e,t){for(var n in t)e[n]=t[n];return e}function a(){var e=t.call(arguments),n=e.shift();return e.reduce(r,n)}function o(e){return Array.isArray(e)?e.slice(0):e.split(".")}function i(e,t,n){for(t=o(t);t.length;){if(null==e)return n;e=e[t.shift()]}return null==e?n:e}function u(e,t,n){var r=(t=o(t)).pop(),a=i(e,t);return a&&(a[r]=n),e}function s(e){return(e=parseInt(e,10))>=10?e:"0"+e}var c={FULLSCREEN:"is-fullscreen",PLAYING:"is-playing",PAUSED:"is-paused",MUTED:"is-muted",LOADED:"is-loaded",LOADING:"is-loading",STARTING:"is-starting",SEEKING:"is-seeking",GRABBING:"is-grabbing",DISABLED:"is-disabled",SMALL:"is-small",TINY:"is-tiny",RTL:"is-rtl",ENDED:"is-ended",LIVE:"is-live",ERRORED:"is-error",WAITING:"is-waiting",AUTOPLAY:"is-autoplay",SEAMLESS:"is-seamless",NO_AUTOPLAY:"no-autoplay",TOGGLING:"is-toggling",LIVE_SEEKED:"is-live-seeked",NO_DVR:"no-timeline"},f={MOUNT:"mount",ERROR:"error",CONTEXT_MENU:"contextmenu",CLICK:"click",DBL_CLICK:"dblclick",KEYUP:"keyup",KEYDOWN:"keydown",LOAD:"load",MOUSE_ENTER:"mouseenter",MOUSE_LEAVE:"mouseleave",MOUSE_UP:"mouseup",MOUSE_DOWN:"mousedown",MOUSE_MOVE:"mousemove",TOUCH_START:"touchstart",TOUCH_MOVE:"touchmove",TOUCH_END:"touchend",TOUCH_CANCEL:"touchcancel",RESIZE:"resize",SCROLL:"scroll",FULLSCREEN_ENTER:"fullscreenenter",FULLSCREEN_EXIT:"fullscreenexit",FULLSCREEN_CHANGE:"fullscreenchange",WEBKIT_NEEDKEY:"webkitneedkey",METADATA:"loadedmetadata",DATA:"loadeddata",PROGRESS:"progress",TIME_UPDATE:"timeupdate",LOAD_START:"loadstart",VOLUME_CHANGE:"volumechange",PAUSE:"pause",PLAYING:"playing",PLAY:"play",WAITING:"waiting",CAN_PLAY:"canplay",ENDED:"ended",SEEKED:"seeked",SEEKING:"seeking",DURATION_CHANGE:"durationchange",BEFORE_PLAY:"beforeplay",BEFORE_PAUSE:"beforepause",STATE:"state",CUEPOINTS:"cuepoints",CUEPOINT_START:"cuepointstart",CUEPOINT_END:"cuepointend",VIEW_ENTER:"viewenter",VIEW_LEAVE:"viewleave",SOURCE:"src",RECOVER:"recover",REAP:"reap",CONFIG:"config",QUALITIES:"qualities",SET_QUALITY:"quality:set",NON_RECOVERABLE_ERROR:"error:fatal",RECOMMENDATIONS_READY:"recommendationsready",AUDIO_ONLY_SOURCE:"audioonlysource"};function l(e){return"function"==typeof e}function d(){throw new Error("Function was expected as Argument[0]")}var p=[].slice;function m(e){if(!(this instanceof m))return new m(e);var t=this;return t.data=e,t.tap=function(){var e=p.call(arguments),n=e.shift();return n==m.lift?t.data:l(n)?(n.apply(t,[t.data].concat(e)),t):void d()},t.into=t.fmap=function(){var e=p.call(arguments),n=e.shift();return n==m.lift?t.data:l(n)?m(n.apply(t,[t.data].concat(e))):void d()},t.unwrap=function(){return t.data},t}m.of=m,m.lift=function(e){return e instanceof m?e.data:e},m._apply=function(e,t){if(0==t.length)return e();if(1==t.length)return e(t[0]);if(2==t.length)return e(t[0],t[1]);if(3==t.length)return e(t[0],t[1],t[2]);if(4==t.length)return e(t[0],t[1],t[2],t[3]);if(5==t.length)return e(t[0],t[1],t[2],t[3],t[4]);throw new Error("Pipe._apply() does not support arity > 5")},m.maybe=function(e,t,n){return e?m._apply(t,[e].concat(p.call(arguments,2,arguments.length))):e},m.curry=function(e,t,n){return(t=t||[]).length>e.length-1?e.apply(n,t):function(){return t=t.concat(p.call(arguments)),m.curry(e,t,n)}};var y=[].slice,E=Array.isArray;function v(e){return e&&"object"==typeof e&&"[object RegExp]"!==Object.prototype.toString.call(e)&&"[object Date]"!==Object.prototype.toString.call(e)}function _(e,t){return e.length===e.filter(t).length}function g(){return _(y.call(arguments),E)}function O(e,t){for(var n in e)t(n,e[n])}function A(e){return v(e)?E(e)?e.map(A):T({},e):e}function h(e,t){var n={};return O(e,(function(e,t){n[e]=A(t)})),function(e,t){return O(t,(function(t,n){if(void 0===e[t])return e[t]=A(n);e[t]=T(e[t],n)})),e}(n,t)}function T(e,t){return g(e,t)?function(e){return A(e)}(e):!1===e?e:!0===e&&!1!==t?t:!v(e)&&v(t)?t:void 0===e||v(e)?v(e)&&!v(t)?e:function(){return _(y.call(arguments),v)}(e,t)?h(e,t):void 0:e}function w(){return[].reduce.call(arguments,(function(e,t){return T(e,t)}),g.apply(null,arguments)?[]:{})}function N(){return w.apply(null,y.call(arguments).reverse())}function S(e,t){var n=new XMLHttpRequest;n.open("GET",e,!0),n.onreadystatechange=function(){try{var e=n.status;if(n.readyState<4)return;if(200!=e&&n.readyState>3&&"function"==typeof t.err){var a={status:e};try{r(a,JSON.parse(n.responseText))}catch(a){}return t.err(a)}t.ok(JSON.parse(n.responseText))}catch(a){console.error(a),t.err(a)}},n.send()}function C(){var e=[].join.call(arguments,"/");return"/"!==e[0]&&(e="/"+e),(flowplayer.OVP_API||"https://ljsp.lwcdn.com")+"/web/public/native/config"+e}function R(e){return~e.indexOf("/")?e:"/media/"+e}var L={404:"media not found",402:"invalid subscription",400:"bad request",415:"unsupported media type"};var b=/.mp4$/;var I={media_id:"id",media_duration:"duration",media_name:"title",media_tags:"tags",category:"category_name",ad_keywords:"ad_keywords"};function D(e,t,n){for(var r in n=n||{},e)n[r]=i(t||{},e[r]);return n}var U=["src","metadata","title","description","duration","poster"];function P(e){var t=i(e,"ima.ads");return Array.isArray(t)&&u(e,"ima.ads",t.map((function(t){return"number"==typeof t.percentage&&(t.time=t.percentage*e.duration),t}))),e}function M(e,t){t="object"==typeof t?t:{};var n,r,o,u={title:i(e,"metadata.title",null),description:i(e,"metadata.description",null)};return"object"==typeof(n=e)&&Array.isArray(n.src)&&b.test(n.src[0])&&(n.src=n.src.reverse()),N({ima:{parameters:D(I,u)}},u,e,(r=U,o=a({},t),r.forEach((function(e){delete o[e]})),o))}var j=/[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}/;function x(e){return"object"==typeof e&&"ovp/base64"==e.type}function k(e,t,n){return function(e,t){return!(~e.indexOf(".")||!j.test(e))&&(t.type="video/ovp",!0)}(e,t)||x(t)}function V(e){try{return G(decodeURIComponent(atob(e).split("").map((function(e){return"%"+("00"+e.charCodeAt(0).toString(16)).slice(-2)})).join("")))}catch(e){return{err:e.message}}}function G(e){return null===e?{}:JSON.parse(e)}var Y=Object.freeze({__proto__:null,base64:V,json:G});function W(e){var t=e.split(/[^0-9]/);return Date.UTC(t[0],t[1]-1,t[2],t[3],t[4],t[5])}var F="ovp:error",H="ovp:request:start",q="ovp:request:media:complete",K="ovp:request:playlist:complete",B="ovp:live:countdown:tick",Q="ovp:live:countdown:start",z="ovp:live:countdown:complete",J=Object.freeze({__proto__:null,OVP_ERROR:F,OVP_MEDIA_REQUEST_START:H,OVP_MEDIA_REQUEST_COMPLETE:q,OVP_PLAYLIST_REQUEST_COMPLETE:K,LIVE_COUNTDOWN_TICK:B,LIVE_COUNTDOWN_START:Q,LIVE_COUNTDOWN_COMPLETE:z});function X(e,t){if(x(t))return Z(e,t);m(t).fmap(i,"src").fmap(R).fmap(C).fmap(S,{ok:m.curry($,[e]),err:m.curry(ee,[e])})}function Z(e,t){m(t).fmap(i,"src").fmap(m.maybe,V).fmap(m.maybe,m.curry($,[e]))}function $(e,t){if(i(t,"playlist"))return ne(e,t);if(i(t,"live"))return re(e,t);if(i(t,"src"))return te(e,t);throw new Error("Status[200] >> unhandled case\n"+JSON.stringify(t,null,2))}function ee(e,t){return t.message?e.emit(F,t):t.status?e.emit(F,new Error(L[t.status])):e.emit(F,t)}function te(e,t){e.emit(q,m.of(t).fmap(M,e.opts).fmap(P).fmap(m.lift))}function ne(e,t){if("function"!=typeof flowplayer.playlist)return console.warn("OVP responded with Playlist media but the playlist plugin does not exist"),ee(e,{status:415});var n,r,o,u;e.emit(K,(n=e.opts,r=t,o=a({},n),a(u=N({},r,i(n,"playlist",{})),{playlist:i(u,"playlist",[]).map((function(e){return M(e,o)}))})))}function re(e,t){var n=i(t,"metadata.live_start_time",i(t,"metadata.starttime"));u(t,"live_start_time",m.of(n).fmap(W).fmap(m.lift)),e.emit(Q,m.of(t).fmap(M,e.opts).fmap(P).fmap(m.lift))}var ae={};function oe(e,t){if("object"==typeof ae[t])return console.debug("using Cache(%s)",t),ie(e,t,ae[t]);m(t).fmap(C).fmap(S,{ok:m.curry(ie,[e,t]),err:console.error})}function ie(e,t,n){"object"!=typeof ae[t]&&(ae[t]=n);var r=i(e,"opts",{}),o=i(r,"metadata",{});u(o,"player_id",t),["title","description"].forEach((function(e){!0===n[e]&&"string"==typeof r[e]&&u(n,e,i(r,e))})),u(r,"metadata",o);var s=a(r,n);e.setOpts(s),n.autoplay&&e.togglePlay(!0)}var ue=Object.freeze({__proto__:null,fetch_unknown_media:X,handle_base64:Z,handle_200:$,handle_err:ee,handle_single_media:te,handle_playlist:ne,handle_live:re,fetch_player_id:oe,handle_player_only:ie});function se(e){console.error("Failed to load recommendations: %j",e)}function ce(e,t){var n=t.playlist;u(e,"opts.recommendations",n),i(n,"length",0)&&e.emit(f.RECOMMENDATIONS_READY,{playlist:n.map((function(e){return{poster:e.poster,src:e.src,title:i(e,"metadata.title"),metadata:e.metadata||{}}}))})}function fe(e){return e.emit=function(t,n,a){a=a||{};var o=function(e){var t=document.createEvent("Event");return t.initEvent(e,!1,!0),t}(t);return n&&r(o,{data:n||{}}),e.dispatchEvent(o),!1===a.return_self?o:e},e.on=function(t,n){return"string"==typeof t&&(t=t.split(" ")),t.forEach((function(t){e.addEventListener(t,n)})),e},e.off=function(t,n){return e.removeEventListener(t,n),e},e.one=e.once=function(t,n){return e.on(t,(function r(a){e.off(t,r),n(a)}))},e}var le="",de=" ",pe=Array.isArray,me="undefined"!=typeof window&&fe(window),ye="undefined"!=typeof document&&fe(document),Ee=["span","a","em","p","i"],ve=Ee.concat(["div","strong","video","img","ol","ul","li","script"]),_e="__flowplayer__";function ge(e,t,n){var r=Ae(document.createElement(e));if(pe(t)&&(n=t,t=!1),pe(n)||(n=[n]),r.append(n.filter((function(e){return e}))),"object"!=typeof t)return r;for(var a in t)a in r?r[a]=t[a]:r.setAttribute(a,t[a]);return r}function Oe(e){var n=e.tagName;e[_e]=1,e.find=function(t){var n=e.querySelector(t);return n?Ae(n):n},e.html=function(t){return e.innerHTML=t,e},e.empty=function(){return e.innerHTML=le,e},e.offset=function(){var t={top:0,left:0},n=e;do{t.left+=n.offsetLeft||0,t.top+=n.offsetTop||0}while(n=n.offsetParent);return t},e.innerWidth=function(){var t=getComputedStyle(e);return e.clientWidth-parseFloat(t.paddingLeft)-parseFloat(t.paddingRight)};var r=e.insert=function(t,n){return pe(n)?n.map((function(n){return e.insert(t,n)}))[0]:Ae(n="string"==typeof n?e.insertAdjacentHTML(t,n):e.insertAdjacentElement?e.insertAdjacentElement(t,n):e.appendChild(n))};return e.append=r.bind(e,"beforeend"),e.prepend=r.bind(e,"afterbegin"),e.css=function(t,n){if("object"==typeof t){for(var r in t)e.css(r,t[r]);return e}return void 0===n?getComputedStyle(e)[t]:(1*n&&(n+="px"),e.style[t]=n,e)},e.show=function(){return e.css({display:~Ee.indexOf(n)?"inline":"block"})},e.hide=function(){return e.css({display:"none"})},e.remove=function(){var t=e.parentNode;t&&t.removeChild(e)},e.attr=function(t,n){return null==n?e.getAttribute(t):(e.setAttribute(t,n),e)},e.txt=function(t){return e.textContent=t,e},e.fp=function(t){return e.addClass("fp-"+t)},e.addClass=function(t){return t.split(de).forEach((function(t){e.hasClass(t)||(e.className+=(e.className?de:le)+t)})),e},e.removeClass=function(t){t=t.split(de);var n=e.className.split(de);return e.className=n.filter((function(e){return!~t.indexOf(e)})).join(" "),e},e.toggleClass=function(t,n){return void 0===n&&(n=!e.hasClass(t)),n?e.addClass(t):e.removeClass(t)},e.findAll=function(n){return r=e.querySelectorAll(n),t.call(r);var r},e.hasClass=function(t){return~e.className.split(de).indexOf(t)},e}function Ae(e){return void 0===e?e:function(e){return e&&e[_e]}(e)?e:Oe(fe(e))}function he(e,t){if("string"==typeof e&&"<"==e[0])return ge(e.slice(1,-1),t);if("string"!=typeof e)return Ae(e);var n=t instanceof HTMLElement&&t.querySelector(".fp-"+e)||document.querySelector(e);return n?Ae(n):void 0}function Te(e,t,r){if(!(this instanceof Te))return new Te(e,t,r);var a=this;if(e.live_start_time<Date.now())return a;var o=0==r._t("ovp.starting_in").length?"Starting in":r._t("ovp.starting_in");function u(e){var n=i(e,"data.remaining",-1);if(n<0||isNaN(n))return r.emit(z);t.addClass("is-livecountdown"),a.countdown.txt(function(e){var t,n,r;t=Math.floor(e/86400),e-=86400*t,n=Math.floor(e/3600),e-=3600*n,r=Math.floor(e/60),e-=60*r;var a="";t&&(a+=t+"d ");return a+n+"h "+s(r)+"m "+s(e)+"s"}(n+1))}a.container=t.append(he.div({class:"fp-livecountdown"})),a.inner=a.container.append(he.div({class:"fp-inner"})),a.inner.append(he.p({},o)),a.countdown=a.inner.append(he.p({class:"fp-countdown"})),r.on(B,u),r.one(z,(function(){a.container&&a.container.remove(),t.removeClass("is-livecountdown"),r.off(B,u),a.container=a.inner=a.countdown=0})),function(e,t){var r,a;function o(){clearInterval(r),clearInterval(a)}function u(){return e=t.live_start_time,n=i(t,"server_time_offset",0),r=Date.now()-n,Math.floor((e-r)/1e3);var e,n,r}function s(){var t=u();if(e.emit(B,{remaining:t}),t<0||0===e.reaper)return o()}function c(){var r,a;if(0===u()||0===e.reaper)return o();r=t,a={err:console.error,ok:n},S((flowplayer.OVP_API||"https://ljsp.lwcdn.com")+"/web/public/countdown/time.json",{err:a.err,ok:function(e){var t=Date.now()-e.millisUtc;a.ok(T(r,{server_time_offset:t}))}})}s()&&c(),r=setInterval(s,250),a=setInterval(c,1e4)}(r,e)}he.window=me,he.document=ye,he.el=ge,ve.forEach((function(e){he[e]=function(t,n){return"string"==typeof t&&(t={class:t}),ge(e,t,n)}}));var we="flowplayer-ovp-branding-";function Ne(e,t,n){var r=we+t;if(!e.hasClass(r)){!function(e){if(-1==e.className.indexOf(we))return;e.className=e.className.split(" ").filter((function(e){return-1==e.indexOf(we)})).join(" ")}(e);var a=function(e){if(document.getElementById(e))return!1;var t=document.createElement("style");return t.id=e,t.appendChild(document.createTextNode("")),document.head.appendChild(t),t.sheet}(r);a&&(!function(e,t,n,r){if("insertRule"in e)return e.insertRule(t+"{"+n+"}",r);if("addRule"in e)e.addRule(t,n,r)}(a,"."+r+" .fp-color","background-color: #"+n+";"),e.addClass(r))}}function Se(e,t,n,r){if(4==arguments.length&&"object"==typeof r)return"string"!=typeof e.player_id||0===r.src.indexOf(e.player_id)||x(r)||(r.src=[e.player_id,r.src].join("/")),X(n,r);n.on(F,(function(e){n.emit(f.ERROR,e.data)})),n.on(H,(function(){n.setState(c.WAITING,!0),e.recommendations&&(e.recommendations=1)})),n.on(q,(function(e){0==n.reaper||"object"!=typeof e.data||Ce(e.data)||(n.setOpts(e.data),n.setAttrs(e.data),n.setSrc(i(e,"data.src")),e.data.autoplay&&n.togglePlay(!0,(function(){setTimeout(n.setState,0,c.SEAMLESS,!1)})))})),n.on(f.CONFIG,(function(r){var a=i(r,"data.brand_color"),o=i(r,"data.metadata.player_id");if(a&&o&&Ne(t,o,a),!("string"==typeof e.src&&k(e.src,{})||e.src&&e.src.length&&"ovp/base64"===e.src[0].type))return"string"==typeof e.player_id&&i(e,"metadata.player_id")!==e.player_id?oe(n,e.player_id):void 0})),n.on(K,(function(e){0!=n.reaper&&"object"==typeof e.data&&flowplayer.playlist(t,e.data)})),n.on(Q,(function(r){if(0!=n.reaper&&"object"==typeof r.data)return n.setOpts(r.data),n.setAttrs(r.data),Ce(r.data)?(new Te(e,t,n),void n.one(z,(function(){return n.emit(q,r.data)}))):n.emit(q,r.data)})),n.on(f.TIME_UPDATE,(function(){e.live||e.recommendations&&i(e,"metadata.media_id")&&(Array.isArray(e.recommendations)||n.currentTime/n.duration<.8||function(e,t,n){m.of("recommendation").fmap(C,t,n).fmap(S,{err:se,ok:m.curry(ce,[e])})}(n,i(e,"metadata.media_id"),i(e,"metadata.player_id")))}))}function Ce(e){return e&&e.live_start_time-Date.now()>0}return Se.wants=k,function(e,t){if("object"==typeof exports&&"undefined"!=typeof module)return t;"flowplayer"in e||(e.flowplayer={extensions:[]});var n=e.flowplayer;"function"==typeof n?n(t):(Array.isArray(n.extensions)||(n.extensions=[]),~n.extensions.indexOf(t)||n.extensions.push(t))}("undefined"!=typeof window?window:void 0!==e?e:{},r(Se,{events:J,Decode:Y,Loader:ue})),Se}));
