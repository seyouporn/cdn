!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):((e=e||self).flowplayer=e.flowplayer||{},e.flowplayer.endscreen=t())}(this,(function(){"use strict";var e={MOUNT:"mount",ERROR:"error",CONTEXT_MENU:"contextmenu",CLICK:"click",DBL_CLICK:"dblclick",KEYUP:"keyup",KEYDOWN:"keydown",LOAD:"load",MOUSE_ENTER:"mouseenter",MOUSE_LEAVE:"mouseleave",MOUSE_UP:"mouseup",MOUSE_DOWN:"mousedown",MOUSE_MOVE:"mousemove",TOUCH_START:"touchstart",TOUCH_MOVE:"touchmove",TOUCH_END:"touchend",TOUCH_CANCEL:"touchcancel",RESIZE:"resize",SCROLL:"scroll",FULLSCREEN_ENTER:"fullscreenenter",FULLSCREEN_EXIT:"fullscreenexit",FULLSCREEN_CHANGE:"fullscreenchange",WEBKIT_NEEDKEY:"webkitneedkey",METADATA:"loadedmetadata",DATA:"loadeddata",PROGRESS:"progress",TIME_UPDATE:"timeupdate",LOAD_START:"loadstart",VOLUME_CHANGE:"volumechange",PAUSE:"pause",PLAYING:"playing",PLAY:"play",WAITING:"waiting",CAN_PLAY:"canplay",ENDED:"ended",SEEKED:"seeked",SEEKING:"seeking",DURATION_CHANGE:"durationchange",BEFORE_PLAY:"beforeplay",BEFORE_PAUSE:"beforepause",STATE:"state",CUEPOINTS:"cuepoints",CUEPOINT_START:"cuepointstart",CUEPOINT_END:"cuepointend",VIEW_ENTER:"viewenter",VIEW_LEAVE:"viewleave",SOURCE:"src",RECOVER:"recover",REAP:"reap",CONFIG:"config",QUALITIES:"qualities",SET_QUALITY:"quality:set",NON_RECOVERABLE_ERROR:"error:fatal",RECOMMENDATIONS_READY:"recommendationsready",AUDIO_ONLY_SOURCE:"audioonlysource"},t=[].slice;function n(e,t,n){for(t=function(e){return Array.isArray(e)?e.slice(0):e.split(".")}(t);t.length;){if(null==e)return n;e=e[t.shift()]}return null==e?n:e}function r(e){return e.emit=function(t,n,r){r=r||{};var i=function(e){var t=document.createEvent("Event");return t.initEvent(e,!1,!0),t}(t);return n&&function(e,t){for(var n in t)e[n]=t[n]}(i,{data:n||{}}),e.dispatchEvent(i),!1===r.return_self?i:e},e.on=function(t,n){return"string"==typeof t&&(t=t.split(" ")),t.forEach((function(t){e.addEventListener(t,n)})),e},e.off=function(t,n){return e.removeEventListener(t,n),e},e.one=e.once=function(t,n){return e.on(t,(function r(i){e.off(t,r),n(i)}))},e}var i="",o=" ",a=Array.isArray,l="undefined"!=typeof window&&r(window),s="undefined"!=typeof document&&r(document),u=["span","a","em","p","i"],c=u.concat(["div","strong","video","img","ol","ul","li","script"]),f="__flowplayer__";function p(e,t,n){var r=y(document.createElement(e));if(a(t)&&(n=t,t=!1),a(n)||(n=[n]),r.append(n.filter((function(e){return e}))),"object"!=typeof t)return r;for(var i in t)i in r?r[i]=t[i]:r.setAttribute(i,t[i]);return r}function d(e){var n=e.tagName;e[f]=1,e.find=function(t){var n=e.querySelector(t);return n?y(n):n},e.html=function(t){return e.innerHTML=t,e},e.empty=function(){return e.innerHTML=i,e},e.offset=function(){var t={top:0,left:0},n=e;do{t.left+=n.offsetLeft||0,t.top+=n.offsetTop||0}while(n=n.offsetParent);return t},e.innerWidth=function(){var t=getComputedStyle(e);return e.clientWidth-parseFloat(t.paddingLeft)-parseFloat(t.paddingRight)};var r=e.insert=function(t,n){return a(n)?n.map((function(n){return e.insert(t,n)}))[0]:y(n="string"==typeof n?e.insertAdjacentHTML(t,n):e.insertAdjacentElement?e.insertAdjacentElement(t,n):e.appendChild(n))};return e.append=r.bind(e,"beforeend"),e.prepend=r.bind(e,"afterbegin"),e.css=function(t,n){if("object"==typeof t){for(var r in t)e.css(r,t[r]);return e}return void 0===n?getComputedStyle(e)[t]:(1*n&&(n+="px"),e.style[t]=n,e)},e.show=function(){return e.css({display:~u.indexOf(n)?"inline":"block"})},e.hide=function(){return e.css({display:"none"})},e.remove=function(){var t=e.parentNode;t&&t.removeChild(e)},e.attr=function(t,n){return null==n?e.getAttribute(t):(e.setAttribute(t,n),e)},e.txt=function(t){return e.textContent=t,e},e.fp=function(t){return e.addClass("fp-"+t)},e.addClass=function(t){return t.split(o).forEach((function(t){e.hasClass(t)||(e.className+=(e.className?o:i)+t)})),e},e.removeClass=function(t){t=t.split(o);var n=e.className.split(o);return e.className=n.filter((function(e){return!~t.indexOf(e)})).join(" "),e},e.toggleClass=function(t,n){return void 0===n&&(n=!e.hasClass(t)),n?e.addClass(t):e.removeClass(t)},e.findAll=function(n){return r=e.querySelectorAll(n),t.call(r);var r},e.hasClass=function(t){return~e.className.split(o).indexOf(t)},e}function y(e){return void 0===e?e:function(e){return e&&e[f]}(e)?e:d(r(e))}function m(e,t){if("string"==typeof e&&"<"==e[0])return p(e.slice(1,-1),t);if("string"!=typeof e)return y(e);var n=t instanceof HTMLElement&&t.querySelector(".fp-"+e)||document.querySelector(e);return n?y(n):void 0}function v(e,t){if(1!=!!t)throw new Error(e)}function E(e,t){this.mode=t.mode,this.sort=t.sort||E._sort,this.members=this.sort(e.slice(0),t.mode),this.last_idx=this.members.length-1,this.plays=t.plays||0,this.idx=-1}m.window=l,m.document=s,m.el=p,c.forEach((function(e){m[e]=function(t,n){return"string"==typeof t&&(t={class:t}),p(e,t,n)}}));var A=E.modes={SHUFFLE:1,FIFO:2,LOOP:4};E.is_ended=function(e){return e.idx==e.last_idx},E.reduce=function(e,t,n){return e.members.reduce.apply(e.members,[].slice.call(arguments,1,arguments.length))},E.map=function(e,t){return e.members.map.apply(e.members,[].slice.call(arguments,1,arguments.length))},E.next_video=function(e){if(!E.is_ended(e)||0!=(e.mode&A.LOOP))return e.members[E.next_id(e)]},E.prev_video=function(e){if(0!==e.idx||0!=(e.mode&A.LOOP))return e.members[E.prev_id(e)]},E.current_video=function(e){return-1==e.idx?e.members[0]:e.members[e.idx]},E.next_id=function(e){var t=e.idx+1;return t>e.last_idx?0:t},E.prev_id=function(e){var t=e.idx-1;return t<0?e.last_idx:t},E.lpop=function(e){return++e.idx,e.members[e.idx]},E._sort=function(e,t){return(t&A.SHUFFLE)==A.SHUFFLE?e.sort((function(){return Math.random()-Math.random()})):e.slice(0)},E.reset=function(e){return new E(e.members,{mode:e.mode,plays:e.plays+1,sort:e.sort})},E.of=function(e,t){var n=t.shuffle?A.SHUFFLE:A.FIFO;return t.loop&&(n|=A.LOOP),new E(e,{mode:n,sort:t.sort})};var _={PLAYLIST_NEXT:"playlist:next",PLAYLIST_PREVIOUS:"playlist:previous",PLAYLIST_LOOP:"playlist:loop",PLAYLIST_ENDED:"playlist:ended",PLAYLIST_READY:"playlist:ready",PLAYLIST_INTERSTITIAL:"playlist:interstitial",PLAYLIST_INTERSTITIAL_END:"playlist:interstitial_end"},L={FULLSCREEN:"is-fullscreen",PLAYING:"is-playing",PAUSED:"is-paused",MUTED:"is-muted",LOADED:"is-loaded",LOADING:"is-loading",STARTING:"is-starting",SEEKING:"is-seeking",GRABBING:"is-grabbing",DISABLED:"is-disabled",SMALL:"is-small",TINY:"is-tiny",RTL:"is-rtl",ENDED:"is-ended",LIVE:"is-live",ERRORED:"is-error",WAITING:"is-waiting",AUTOPLAY:"is-autoplay",SEAMLESS:"is-seamless",NO_AUTOPLAY:"no-autoplay",TOGGLING:"is-toggling",LIVE_SEEKED:"is-live-seeked",NO_DVR:"no-timeline"};function h(e){return"function"==typeof e}function T(){throw new Error("Function was expected as Argument[0]")}var I=[].slice;function S(e){if(!(this instanceof S))return new S(e);var t=this;return t.data=e,t.tap=function(){var e=I.call(arguments),n=e.shift();return n==S.lift?t.data:h(n)?(n.apply(t,[t.data].concat(e)),t):void T()},t.into=t.fmap=function(){var e=I.call(arguments),n=e.shift();return n==S.lift?t.data:h(n)?S(n.apply(t,[t.data].concat(e))):void T()},t.unwrap=function(){return t.data},t}function g(e){return"invalid playlist configuration\ndetails: "+e+"\n\tmust match Object of shape:\n"+["\t\t{ controls?: Selector|HTMLElement","player:    Selector|HTMLElement","playlist:  PlaylistId|Array(MediaId|PlayerConfig)","shuffle?:  Boolean|false","loop?:     Boolean|false","advance?:  Boolean|true","delay?:    Milliseconds|5000"].join("\n\t\t, ")+"\n\t\t}"}function b(e,t){S.of(e).fmap(g).fmap(v,t)}function w(e){return void 0!==e}function N(e){return"string"==typeof e}function O(e){return"object"==typeof e}function x(e){try{return e instanceof HTMLElement}catch(t){return O(e)&&O(e.style)&&O(e.ownerDocument)}}function P(e){var t;b("Config must be an Object",w(e)&&O(e)),b("property `playlist` is required",w(e.playlist)),b("property `playlist` was not a String(MediaId)",N(e.playlist)||(t=e.playlist,b("playlist property was not of type PlaylistId|Array(MediaId|PlayConfig)",Array.isArray(t)),b("playlist property cannot be an empty Array",t.length>0),!t.forEach((function(e,t){b("item at playlist["+t+"] was not valid",N(e)||O(e))})))),"loop shuffle".split(" ").forEach((function(t){w(e[t])&&b(t+" must be a boolean value if present","boolean"==typeof e[t])})),w(e.delay)&&b("property `delay` must be a Number (Milliseconds)","number"==typeof e.delay)}function C(e,t,n){var r=E.lpop(t),i=t.idx+t.plays<1;return function(e,t,n){"object"==typeof t&&e.setOpts(t);R(e,t,n)}(e,r,n),i&&n.autoplay?e.togglePlay(!0):i?e.setState(L.STARTING,!0):!i&&n.advance?k(e,n,(function(){e.paused&&(e.setState(L.SEAMLESS,!0),e.play())})):void e.emit(_.PLAYLIST_INTERSTITIAL,{config:n})}function R(e,t,r){if(e.setSrc(N(t)||t.type?t:t.src),e.emit(_.PLAYLIST_NEXT,t),n(r,"should_play",!1))return e.play()}function D(e,t){t=e.playlist.queue=E.reset(t),e.emit(_.PLAYLIST_READY,{queue:t,should_play:!1})}function k(e,t,n){var r=setTimeout(n,t.delay||0);t.delay>0&&e.emit(_.PLAYLIST_INTERSTITIAL,{timer:r,config:t})}function Y(e,t,n){if(t[e])return(n=n||[]).unshift(m.span({innerText:t[e]})),m.div({class:e},n)}S.of=S,S.lift=function(e){return e instanceof S?e.data:e},S._apply=function(e,t){if(0==t.length)return e();if(1==t.length)return e(t[0]);if(2==t.length)return e(t[0],t[1]);if(3==t.length)return e(t[0],t[1],t[2]);if(4==t.length)return e(t[0],t[1],t[2],t[3]);if(5==t.length)return e(t[0],t[1],t[2],t[3],t[4]);throw new Error("Pipe._apply() does not support arity > 5")},S.maybe=function(e,t,n){return e?S._apply(t,[e].concat(I.call(arguments,2,arguments.length))):e},S.curry=function(e,t,n){return(t=t||[]).length>e.length-1?e.apply(n,t):function(){return t=t.concat(I.call(arguments)),S.curry(e,t,n)}};var q={coords:"0 0 41 42",link:"#fp-skip-next",translation_key:"core.skip-next",name:"fp-skip-next"},U={coords:"0 0 41 42",link:"#fp-skip-prev",translation_key:"core.skip-prev",name:"fp-skip-prev"};function M(e){return document.createElementNS("http://www.w3.org/2000/svg",e)}function j(e){var t,n,r=M("svg");return r.setAttribute("viewBox",e.coords),e.name&&r.setAttribute("class",e.name),e.title&&r.setAttribute("title",e.title),e.title&&r.setAttribute("aria-label",e.title),r.setAttribute("tabindex","0"),r.appendChild((t=e.link,(n=M("use")).setAttributeNS("http://www.w3.org/1999/xlink","xlink:href",t),n)),m(r)}var F="is-playlist",G="is-prev-button-disabled",H="is-next-button-disabled";function B(t,r,i){m(t),t.addClass("fp-playlist-controls "+(i.theme||"fp-dark")),r.setState(F,!0);var o=r.root.className.split(" ").filter((function(e){return e.match(/^use-play/)})).pop();if(o&&t.addClass(o),r.on([_.PLAYLIST_NEXT,e.PLAYING,e.PAUSE,_.PLAYLIST_READY],(function(e){var i=n(e,"data.queue",n(r,"playlist.queue"));if(i&&(new V(t,i,r),r.root.controls.btns.toggleClass(G,!i.idx),r.root.controls.btns.toggleClass(H,i.idx===i.last_idx),r.skip_controls)){var o=i.idx<i.last_idx?E.next_video(i):null,a=i.idx>0?E.prev_video(i):null;r.skip_controls.nextPreview.style.backgroundImage=["url(",o?o.poster:null,")"].join(""),r.skip_controls.prevPreview.style.backgroundImage=["url(",a?a.poster:null,")"].join("")}})),i.skip_controls&&!r.skip_controls){var a=function(t){var n=j(U).attr("role","button");n.on(e.CLICK,(function(){t.playlist.prev()}));var r=j(q).attr("role","button");r.on(e.CLICK,(function(){t.playlist.next()}));var i=m.div("fp-playlist-prev-preview"),o=m.div("fp-playlist-next-preview");return t.root.controls.btns.prepend(n),t.root.controls.btns.append(r),t.root.controls.btns.append(i),t.root.controls.btns.append(o),{prevButton:n,nextButton:r,prevPreview:i,nextPreview:o}}(r);r.reaper.put("skip_controls",a),r.on(e.REAP,(function(){for(var e in a)a[e]=0}))}}function V(e,t,n){e.empty();var r=e.append(m.ol("fp-playlist"));E.map(t,(function(e,i){var o=K(e,t,n,i);o&&r.append(o)}))}function K(e,t,n,r){if(e.title){var i={class:r==t.idx?"is-current "+function(e){return e.paused?"is-paused":"is-playing"}(n):"is-queued",onclick:K.onclick.bind(null,e,t,n,r)};return m.li(i,[m.div("fp-color"),W(e),X(e,n)])}}function W(e){return m.div("video-info",[Y("title",e),Y("description",e)])}function X(e,t){var n=m.div("video-buttons",t.root.ui.findAll(".fp-switch").map((function(e){return m(e.cloneNode(!0)).removeClass("fp-switch")})));return e.poster&&(n.style.backgroundImage=["url(",e.poster,")"].join("")),n}K.onclick=function(e,t,n,r){return t.idx!=r||n.paused?t.idx==r&&n.paused?n.play():(t.idx=r,void R(n,e,{should_play:!0})):n.pause()};var Q="is-interstitial";function z(e){return Math.min(100*e,100)+"%"}function Z(e,t){var n=m.div("fp-interstitial"),r=e.root.ui.find(".fp-middle");r.append(n),e.on(_.PLAYLIST_INTERSTITIAL,(function(i){var o=i.data;e.setState(Q,!0);var a=E.current_video(e.playlist.queue);a&&(n.empty().append(Z.Innards(e,a,r,o)),t.advance&&Z.animate_countdown(e,o,n.querySelector(".countdown")))})),e.on("src playing waiting",(function(){e.emit(_.PLAYLIST_INTERSTITIAL_END)})),e.on(_.PLAYLIST_INTERSTITIAL_END,(function(){e.setState(Q,!1)}))}Z.animate_countdown=function(e,t,n){if(!n)throw new Error("no element to animate was passed");var r=t.config.delay,i=Date.now()+r,o=Date.now(),a=Math.ceil(1e3/60);!function l(){var s=Date.now();if(!(s>i)&&e.paused){if(!t.timer)return n.css({width:z(0)});requestAnimationFrame(l),s-o<a||(o=s,n.css({width:z(1-(i-s)/r)}))}}()},Z.Innards=function(e,t,n,r){var i=m.div("left",n.findAll(".fp-switch").map((function(e){return m(e.cloneNode(!0)).removeClass("fp-switch")})));return t.poster&&(i.style.backgroundImage=["url(",t.poster,")"].join("")),[i,m.div("right",[m.div("up-next",[m.span().txt(e._t("playlist.up_next")),m.div("fp-color countdown")]),Y("title",t),Y("description",t),r.timer&&m.div({class:"cancel",onclick:function(e){return clearTimeout(r.timer),r.timer=0,m(e.target).remove(),e.preventDefault(),!1}},[m.span().txt(e._t("playlist.cancel"))])])]};var J=["playlist","controls","shuffle","loop","advance","delay","player","skip_controls"],$=["src"];function ee(e){P(e)}function te(e,t){var n=this;n.queue=t,n.play=function(t){n.queue.idx=t,R(e,E.current_video(n.queue),{should_play:!0})},n.next=function(){n.queue.idx!==n.queue.last_idx&&n.play(n.queue.idx+1)},n.prev=function(){n.queue.idx&&n.play(n.queue.idx-1)},n.remove=function(t){n.queue.members[t]&&(n.queue.members.splice(t,1),n.queue.plays--,D(e,n.queue))},n.push=function(t){n.queue.members=n.queue.members.concat(t),n.queue.plays--,D(e,n.queue)},n.clear=function(){n.queue.members=[],n.queue.plays--,D(e,n.queue)}}function ne(e,t){t.delay="delay"in t?t.delay:1e4,ee(t);const n=function(e){var t={};for(var n in $.forEach((function(t){t in e&&(console.warn(new Error("unsupported attribute: "+t+" found on the top-level config")),delete e[t])})),e)~J.indexOf(n)||(t[n]=e[n]);return t}(t);t=function(e,t){var n={};for(var r in e)J.indexOf(r)<0||(n[r]=e[r]);for(r in t)J.indexOf(r)<0||(n[r]=t[r]);return n}((e=flowplayer(e,n)).opts,t),new Z(e,t);var r=ne.make_controls(e,t);return ne.attach_events(e,r,t),ne.fetch(t,(function(t){e.emit(_.PLAYLIST_READY,{queue:t,should_play:0===e.currentSrc.length})})),e}function re(e){return"invalid recommendations configuration\ndetails: "+e+"\n\tmust match Object of shape:\n"+["\t\t{ playlist:  PlaylistId|Array(MediaId|PlayerConfig)"].join("\n\t\t, ")+"\n\t\t}"}function ie(e,t){S.of(e).fmap(re).fmap(v,t)}function oe(e){return void 0!==e}function ae(e){return"string"==typeof e}function le(e){return"object"==typeof e}function se(e){var t;ie("Config must be an Object",oe(e)&&le(e)),ie("property `playlist` is required",oe(e.playlist)),ie("property `playlist` was not an array nor playlist id",(t=e.playlist,ie("playlist property was not of type PlaylistId|Array(MediaId|PlayConfig)",Array.isArray(t)),!t.forEach((function(e,t){ie("item at playlist["+t+"] was not valid",ae(e)||le(e))}))))}function ue(e,t){var n=function(e,t){var n=m.div({class:"fp-endscreen-cell-thumbnail",onclick:ue.onclick.bind(null,e,t)});e.poster&&(n.style.backgroundImage=["url(",e.poster,")"].join(""));return n}(e,t);return n.append(function(e){var t=e.title||"";return m.div("fp-endscreen-cell-title",t)}(e)),n}ne.make_controls=function(e,t){var n=ne.cast_controls(t);if(n)return m(n),new B(n,e,t),n},ne.cast_controls=function(e){var t,n;if(N(n=e.controls)||x(n))return x(e.controls)?t=e.controls:N(e.controls)&&(t=document.querySelector(e.controls)),v("Count not find controls by Selector["+e.controls+"]",x(t)),t},ne.fetch=function(e,t){if(Array.isArray(e.playlist))return t(E.of(e.playlist,e));throw new Error("config.playlist must be an Array")},ne.attach_events=function(t,n,r){t.on(_.PLAYLIST_READY,(function(e){var n=e.data.queue,i=e.data.should_play;t.reaper.put("playlist",new te(t,n)),i&&C(t,n,r)})),t.on(e.ENDED,(function(){if(E.is_ended(t.playlist.queue))return function(e,t){e.emit(_.PLAYLIST_ENDED),t.loop&&(e.playlist.queue=E.reset(e.playlist.queue),e.emit(_.PLAYLIST_LOOP),k(e,t,(function(){e.emit(_.PLAYLIST_READY,{queue:e.playlist.queue,should_play:!0})})))}(t,r);0!=r.advance&&C(t,t.playlist.queue,r)}))},ne.events=_,ne.VideoQueue=E,ue.onclick=function(e,t){"object"==typeof e&&t.setOpts(e),function(e,t,r){if(e.setSrc(ae(t)?t:t.src),n(r,"should_play",!1))e.play()}(t,e,{should_play:!0})};var ce="is-endscreen";function fe(t,n,r){var i=m.div("fp-endscreen");r.reaper.put("endscreen",i),r.on(e.MOUNT,(function(){r.root.middle.append(i)})),r.on(e.RECOMMENDATIONS_READY,(function(e){var o=e.data;se(o),i.recommendations=o,!r.ended||r.playlist||t.loop||pe(n,i,r)})),r.on(e.ENDED,(function(e){setTimeout((function(){if(i.recommendations&&!r.playlist){if(e.defaultPrevented)return;pe(n,i,r)}}),0)})),r.on(ne.events.PLAYLIST_ENDED,(function(){i.recommendations&&!t.loop&&pe(n,i,r)})),r.on([e.LOAD_START,e.PLAYING],(function(){r.setState(ce,!1)}))}function pe(e,t,n){t.empty();var r=t.recommendations;if(r.playlist&&0!==r.playlist.length){var i=e.hasClass("is-small")||e.hasClass("is-tiny")?6:12,o=[];r.playlist.forEach((function(e,t){o.length!==i&&e.poster&&e.title&&o.push(m.div("fp-endscreen-cell",new ue(e,n,t)))})),0!==o.length&&(t.append(m.div("fp-endscreen-cells",o)),n.setState(ce,!0))}}return function(e,t){if("object"==typeof exports&&"undefined"!=typeof module)return t;"flowplayer"in e||(e.flowplayer={extensions:[]});var n=e.flowplayer;"function"==typeof n?n(t):(Array.isArray(n.extensions)||(n.extensions=[]),~n.extensions.indexOf(t)||n.extensions.push(t))}(window,fe),fe}));
