!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):((e=e||self).flowplayer=e.flowplayer||{},e.flowplayer.keyboard=t())}(this,(function(){"use strict";var e=[].slice;function t(e,t){for(var n in t)e[n]=t[n];return e}function n(e,t,n){for(t=function(e){return Array.isArray(e)?e.slice(0):e.split(".")}(t);t.length;){if(null==e)return n;e=e[t.shift()]}return null==e?n:e}function r(e){return e.emit=function(n,r,i){i=i||{};var o=function(e){var t=document.createEvent("Event");return t.initEvent(e,!1,!0),t}(n);return r&&t(o,{data:r||{}}),e.dispatchEvent(o),!1===i.return_self?o:e},e.on=function(t,n){return"string"==typeof t&&(t=t.split(" ")),t.forEach((function(t){e.addEventListener(t,n)})),e},e.off=function(t,n){return e.removeEventListener(t,n),e},e.one=e.once=function(t,n){return e.on(t,(function r(i){e.off(t,r),n(i)}))},e}var i="",o=" ",a=Array.isArray,u="undefined"!=typeof window&&r(window),s="undefined"!=typeof document&&r(document),c=["span","a","em","p","i"],l=c.concat(["div","strong","video","img","ol","ul","li","script"]),f="__flowplayer__";function d(e,t,n){var r=E(document.createElement(e));if(a(t)&&(n=t,t=!1),a(n)||(n=[n]),r.append(n.filter((function(e){return e}))),"object"!=typeof t)return r;for(var i in t)i in r?r[i]=t[i]:r.setAttribute(i,t[i]);return r}function p(t){var n=t.tagName;t[f]=1,t.find=function(e){var n=t.querySelector(e);return n?E(n):n},t.html=function(e){return t.innerHTML=e,t},t.empty=function(){return t.innerHTML=i,t},t.offset=function(){var e={top:0,left:0},n=t;do{e.left+=n.offsetLeft||0,e.top+=n.offsetTop||0}while(n=n.offsetParent);return e},t.innerWidth=function(){var e=getComputedStyle(t);return t.clientWidth-parseFloat(e.paddingLeft)-parseFloat(e.paddingRight)};var r=t.insert=function(e,n){return a(n)?n.map((function(n){return t.insert(e,n)}))[0]:E(n="string"==typeof n?t.insertAdjacentHTML(e,n):t.insertAdjacentElement?t.insertAdjacentElement(e,n):t.appendChild(n))};return t.append=r.bind(t,"beforeend"),t.prepend=r.bind(t,"afterbegin"),t.css=function(e,n){if("object"==typeof e){for(var r in e)t.css(r,e[r]);return t}return void 0===n?getComputedStyle(t)[e]:(1*n&&(n+="px"),t.style[e]=n,t)},t.show=function(){return t.css({display:~c.indexOf(n)?"inline":"block"})},t.hide=function(){return t.css({display:"none"})},t.remove=function(){var e=t.parentNode;e&&e.removeChild(t)},t.attr=function(e,n){return null==n?t.getAttribute(e):(t.setAttribute(e,n),t)},t.txt=function(e){return t.textContent=e,t},t.fp=function(e){return t.addClass("fp-"+e)},t.addClass=function(e){return e.split(o).forEach((function(e){t.hasClass(e)||(t.className+=(t.className?o:i)+e)})),t},t.removeClass=function(e){e=e.split(o);var n=t.className.split(o);return t.className=n.filter((function(t){return!~e.indexOf(t)})).join(" "),t},t.toggleClass=function(e,n){return void 0===n&&(n=!t.hasClass(e)),n?t.addClass(e):t.removeClass(e)},t.findAll=function(n){return r=t.querySelectorAll(n),e.call(r);var r},t.hasClass=function(e){return~t.className.split(o).indexOf(e)},t}function E(e){return void 0===e?e:function(e){return e&&e[f]}(e)?e:p(r(e))}function m(e,t){if("string"==typeof e&&"<"==e[0])return d(e.slice(1,-1),t);if("string"!=typeof e)return E(e);var n=t instanceof HTMLElement&&t.querySelector(".fp-"+e)||document.querySelector(e);return n?E(n):void 0}m.window=u,m.document=s,m.el=d,l.forEach((function(e){m[e]=function(t,n){return"string"==typeof t&&(t={class:t}),d(e,t,n)}}));var v={MOUNT:"mount",ERROR:"error",CONTEXT_MENU:"contextmenu",CLICK:"click",DBL_CLICK:"dblclick",KEYUP:"keyup",KEYDOWN:"keydown",LOAD:"load",MOUSE_ENTER:"mouseenter",MOUSE_LEAVE:"mouseleave",MOUSE_UP:"mouseup",MOUSE_DOWN:"mousedown",MOUSE_MOVE:"mousemove",TOUCH_START:"touchstart",TOUCH_MOVE:"touchmove",TOUCH_END:"touchend",TOUCH_CANCEL:"touchcancel",RESIZE:"resize",SCROLL:"scroll",FULLSCREEN_ENTER:"fullscreenenter",FULLSCREEN_EXIT:"fullscreenexit",FULLSCREEN_CHANGE:"fullscreenchange",WEBKIT_NEEDKEY:"webkitneedkey",METADATA:"loadedmetadata",DATA:"loadeddata",PROGRESS:"progress",TIME_UPDATE:"timeupdate",LOAD_START:"loadstart",VOLUME_CHANGE:"volumechange",PAUSE:"pause",PLAYING:"playing",PLAY:"play",WAITING:"waiting",CAN_PLAY:"canplay",ENDED:"ended",SEEKED:"seeked",SEEKING:"seeking",DURATION_CHANGE:"durationchange",BEFORE_PLAY:"beforeplay",BEFORE_PAUSE:"beforepause",STATE:"state",CUEPOINTS:"cuepoints",CUEPOINT_START:"cuepointstart",CUEPOINT_END:"cuepointend",VIEW_ENTER:"viewenter",VIEW_LEAVE:"viewleave",SOURCE:"src",RECOVER:"recover",REAP:"reap",CONFIG:"config",QUALITIES:"qualities",SET_QUALITY:"quality:set",NON_RECOVERABLE_ERROR:"error:fatal",RECOMMENDATIONS_READY:"recommendationsready",AUDIO_ONLY_SOURCE:"audioonlysource"};function O(e){return document.createElementNS("http://www.w3.org/2000/svg",e)}function A(e){var t,n,r=O("svg");return r.setAttribute("viewBox",e.coords),e.name&&r.setAttribute("class",e.name),e.title&&r.setAttribute("title",e.title),e.title&&r.setAttribute("aria-label",e.title),r.setAttribute("tabindex","0"),r.appendChild((t=e.link,(n=O("use")).setAttributeNS("http://www.w3.org/1999/xlink","xlink:href",t),n)),m(r)}var R={TOGGLE_OPEN:"menu:toggle:open",RENDER:"menu:render",PUSH:"menu:push"},_={ON:"fp-on",INVIS:"fp-invis"};function C(n,r,i){var o=i.id||"menu-"+Math.random().toString(36).replace(/[^a-z]+/g,"").substr(0,5);return i=i||{},n.attr("role","button").attr("aria-haspopup","true").attr("aria-expanded","false").attr("aria-controls",o).attr("aria-label",i.title),i.options=i.options||[],i.id=o,C._interface(n,r,function(){var n=e.call(arguments),r=n.shift();return n.reduce(t,r)}({},i))}C.title=function(e){return m("<h3>").txt(e)},C.close=function(e){return m.span("fp-close").on(v.CLICK,e).html("&times;")},C.option=function(e,t){var n=this,r=m("<li>").attr("tabindex","0").attr("role","menuitem"),i=n._attrs;e.icon&&r.append(A(e.icon)),r.append(m("<span>").txt(e.text)),r.on(v.CLICK,(function(r){i.multi||n.options().forEach(C.off),n.activate(t),"function"==typeof e.onclick&&e.onclick(r,e,t,n)})),r.idx=t,n.append(r)},C._interface=function(e,t,r){e.addClass("fp-menu-container");var i=m("<ul>").attr("id",r.id).addClass("fp-menu").attr("role","menu");return r.icons&&i.addClass("fp-icons"),i._attrs=r,e.on(v.CLICK,(function(e){setTimeout((function(){if(!e.defaultPrevented)return i.hasClass(_.ON)?t.emit(R.TOGGLE_OPEN,{menu:i,open:!1}):void t.emit(R.TOGGLE_OPEN,{menu:i,open:!0})}),0)})),i.on(v.MOUSE_LEAVE,(function(){t.emit(R.TOGGLE_OPEN,{menu:i,open:!1})})),t.on(R.TOGGLE_OPEN,(function(r){if(n(r,"data.menu")!==i)return i.toggleClass(_.ON,!1),e.attr("aria-expanded","false");var o=n(r,"data.open",!1);if(i.toggleClass(_.ON,o),e.attr("aria-expanded",o?"true":"false"),t.hasClass("is-accessibility"))if(o){var a=i.options()[0];a&&a.focus()}else e.focus()})),i.push=function(e){return i._attrs.options=n(i,"_attrs.options",[]),i._attrs.options.push(e),i.render()},i.select=function(e){return i.render(i.options.filter(e))},i.render=function(t){var n=i._attrs;return i.empty(),i.prepend(C.close()),n.title&&i.prepend(C.title(n.title)),n.options=t||n.options,n.options.forEach(C.option,i),e.toggleClass(_.INVIS,0==n.options.length),i._activate(),i},i.close=function(){i.hasClass(_.ON)&&t.emit(R.TOGGLE_OPEN,{menu:i,open:!1})},i._activate=function(){i.options().forEach((function(e){e.toggleClass(_.ON,e.idx===i.idx)}))},i.options=function(){return[].slice.call(i.querySelectorAll("li"))},i.activate=function(e,t){void 0===i.idx||i.idx!==e||t?i.idx=e:delete i.idx,i._activate()},i.deactivate=function(){i.activate(i.idx)},i.render(r.options),e.appendChild(i),i},C.on=function(e){return e.addClass(_.ON),e},C.off=function(e){return e.removeClass(_.ON),e},C.CONTAINER_CLASS="fp-menu",C.Events=R,C.States=_;var N,T,h={TAB:9,ENTER:13,ESCAPE:27,SPACE:32,ARROW_LEFT:37,ARROW_UP:38,ARROW_RIGHT:39,ARROW_DOWN:40,F:70,H:72,J:74,K:75,L:76,M:77},y="no-timeline",S=(T={val:N},function(e){return void 0!==e&&(T.val=e),T.val}),g=[h.ARROW_UP,h.ARROW_RIGHT,h.ARROW_LEFT,h.ARROW_DOWN],L=[h.SPACE,h.F,h.ESCAPE,h.M,h.ARROW_UP,h.ARROW_DOWN,h.ARROW_RIGHT,h.ARROW_LEFT,h.H,h.J,h.K,h.L];function b(e,t){return Math.max(Math.min(t,e),0)}function x(e,t){e.volume=b(e.volume+t,1)}function P(e,t,n){if(!e.disabled||!t){n=n||.15;var r=e.currentTime,i=e.duration,o=0;n<1&&(o=n*i),n>=1&&(o=n),1==t&&(o=Math.abs(o)),0==t&&o>0&&(o*=-1),e.currentTime=b(r+o,i)}}function w(e,t){return!(!e||document.activeElement===document.body||function(e){var t=document.activeElement;for(;t;){if(t===e)return!0;t=t.parentElement}return!1}(e))||(!e||!e.in_viewport||!e.started||t.altKey||t.shiftKey||t.metaKey||t.ctrlKey)}function U(e,t,n){n.on([v.LOAD_START,v.PLAYING,v.FULLSCREEN_ENTER],(function(){S(n)}))}function W(e,t){return!!I(e,t)}function I(e,t){return!!e.parentElement&&(e.parentElement.matches(t)?e.parentElement:W(e.parentElement,t))}return m.document.on(v.KEYDOWN,(function(e){var t=e.which,r=S(),i=n(r,"opts.keyboard.seek_step",.15),o=document.activeElement;function a(){e.preventDefault(),e.stopPropagation()}if((t===h.SPACE||t===h.ENTER)&&o.hasAttribute("tabindex")&&W(o,".flowplayer"))return o.dispatchEvent(new MouseEvent("click",{bubbles:!0})),a();if(~g.indexOf(t)&&o.hasAttribute("aria-valuenow")){var u=~[h.ARROW_UP,h.ARROW_RIGHT].indexOf(t);if(o.matches(".fp-volume"))return x(r,u?.15:-.15),a();if(o.matches(".fp-timeline"))return P(r,u,i),a()}if((t===h.ARROW_DOWN||t===h.ARROW_UP||t===h.ESCAPE)&&W(o,".fp-menu"))return e.preventDefault(),t===h.ARROW_DOWN&&o.nextSibling&&o.nextSibling.focus(),t===h.ARROW_UP&&o.previousSibling&&o.previousSibling.focus(),void(t===h.ESCAPE&&r.root.emit(C.Events.TOGGLE_OPEN,{open:!1,menu:I(o,".fp-menu")}));if(t===h.TAB&&flowplayer.instances.forEach((function(e){e.setState("is-hovered",!0),e.setState("is-accessibility",!0)})),!w(r,e)){var s=!r.hasState(y);if(t>47&&t<58&&s)return e.preventDefault(),function(e,t){var n=e.duration,r=t/10*n;r>e.currentTime&&e.disabled||n&&(e.currentTime=r)}(r,t-48);switch(~L.indexOf(t)&&e.preventDefault(),t){case h.SPACE:return r.togglePlay();case h.F:return r.toggleFullScreen();case h.ESCAPE:return r.toggleFullScreen(!1);case h.M:return r.toggleMute();case h.ARROW_UP:case h.K:return x(r,.15);case h.ARROW_DOWN:case h.J:return x(r,-.15);case h.ARROW_RIGHT:case h.L:return s&&P(r,!0,i);case h.ARROW_LEFT:case h.H:return s&&P(r,!1,i)}}})),function(e,t){if("object"==typeof exports&&"undefined"!=typeof module)return t;"flowplayer"in e||(e.flowplayer={extensions:[]});var n=e.flowplayer;"function"==typeof n?n(t):(Array.isArray(n.extensions)||(n.extensions=[]),~n.extensions.indexOf(t)||n.extensions.push(t))}(window,U),U}));
